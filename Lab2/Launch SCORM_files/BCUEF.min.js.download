function logMessage(n){enableLog&&console.log(n)}function onPostMessageReceived(n){logMessage("onPostMessageReceived");const t=n.origin===window.__lmsHost||n.origin===integrationHost;t&&n.data&&n.data.type&&n.data.type==="integration:hello"&&(messageChannel=new LoggedMessageChannel(n.ports[0]),messageChannel.onmessage=onMessageFromUltra,messageChannel.postMessage({type:"authorization:authorize",token:window.__token}))}function onMessageFromUltra(n){logMessage("onMessageFromUltra");n.data.type==="authorization:authorize"&&(logMessage("Call authorize"),onAuthorizedWithUltra());n.data.type==="event:event"&&n.data.eventType==="route"&&(logMessage("RouteEvent: "+JSON.stringify(n.data.routeName)),handleRouteEvent(n.data));n.data.type==="portal:modal:response"&&(logMessage("portal:modal:response: "+JSON.stringify(n.data)),modalId=n.data.modalId);n.data.type==="portal:panel:response"&&(portalId=n.data.portalId,renderPanelContents(n));n.data.type==="portal:callback"&&(logMessage("portal:callback: "+JSON.stringify(n.data)),n.data.callbackId===currentPopupHID&&messageChannel.postMessage({type:"portal:modal:close",modalId:currentPopupHID}))}function handleRouteEvent(n){if(n.routeName.indexOf("peek.course.outline")!=-1||n.routeName.indexOf("peek.course.classic.outline")!=-1)if(logMessage(`eventData.routeData.courseId:${n.routeData.courseId}`),logMessage(`currentCourseId:${currentCourseId}`),n.routeData.courseId&&(currentCourseId==""||currentCourseId!=n.routeData.courseId)&&integrationConfig!=null&&integrationConfig.CoursePromptEnabled){currentCourseId=n.routeData.courseId;var t=new XMLHttpRequest;t.open("GET",`${window.__integrationUrl}/api/blackboard/GetBlueEvaluation?userId=${currentUserId}&courseId=${currentCourseId}`,!0);t.setRequestHeader("CONSUMERID",window.__bctoken);t.onreadystatechange=function(){if(t.readyState==4&&t.status==200){currentToolUrl="";var n=t.responseText;n!=null&&n!=""?(currentToolUrl=n,integrationConfig.CoursePromptType==UtraIntegrationType.Prompt?messageChannel.postMessage({type:"portal:modal",modalId:currentPopupHID,contents:getModalContents(currentPopupHID,"300","large",integrationConfig.CourseHeaderText,integrationConfig.CourseButtonText)}):integrationConfig.CoursePromptType==UtraIntegrationType.Panel&&setTimeout(()=>{messageChannel.postMessage({type:"portal:panel",correlationId:"panel-1",panelType:"small",panelTitle:integrationConfig.CourseHeaderText,attributes:{onClose:{callbackId:"panel-1-close"}}})},500),setTimeout(()=>{window.parent.postMessage({type:"BC:CBLaunch"},`${window.__lmsHost}/*`)},500)):currentToolUrl=""}};t.send()}else n.routeData.courseId&&currentCourseId==n.routeData.courseId||(currentCourseId="",currentToolUrl="");else currentCourseId="",localStorage.setItem("BC_POPUP","1");n.routeName=="logout"&&localStorage.removeItem("BC_POPUP")}function onAuthorizedWithUltra(){logMessage("Authorization was successful");var n=window.__integrationUrl+"/JS/BCUltra.min.js";messageChannel.postMessage({type:"injectjs:inject",url:n});GetBlueSettings();messageChannel.postMessage({type:"event:subscribe",subscriptions:["route"]})}function getModalContents(n,t,i,r,u){return{tag:"Modal",props:{width:i},children:[{tag:"ModalHeader",props:{title:r}},{tag:"ModalBody",children:[{tag:"iframe",props:{style:{display:"flex",height:t+"px",width:"100%",flexDirection:"column",alignItems:"stretch",justifyContent:"stretch",border:"0",flex:"1 1 auto"},src:`${window.__integrationUrl}/Feedback/FeedbackRedirect?token=${window.__bcUserToken}&courseId=${currentCourseId}`}}]},{tag:"ModalFooter",children:[{tag:"button",props:{onClick:{callbackId:n,mode:"sync"},key:"demo-modal-close-button",style:{marginBottom:"0"},className:"uef--button"},children:u}]}]}}function renderPanelContents(n){n.data.correlationId==="panel-1"&&(panelId=n.data.portalId,messageChannel.postMessage({type:"portal:render",portalId:n.data.portalId,contents:{tag:"span",props:{style:{display:"flex",height:"100%",width:"100%",flexDirection:"column",alignItems:"stretch",justifyContent:"stretch"}},children:[{tag:"iframe",props:{style:{flex:"1 1 auto"},src:`${window.__integrationUrl}/Feedback/FeedbackRedirect?token=${window.__bcUserToken}&courseId=${currentCourseId}`}}]}}))}function GetBlueSettings(){var n=new XMLHttpRequest;n.open("GET",`${window.__integrationUrl}/api/blackboard/GetBlueUltraSetting?userId=${currentUserId}&language=${window.__locale}`,!0);n.setRequestHeader("CONSUMERID",window.__bctoken);n.onreadystatechange=function(){if(n.readyState==4&&n.status==200){currentToolUrl="";var t=JSON.parse(n.responseText);t!=null&&t!=""?(integrationConfig=t,currentToolUrl=t.ToolUrl,integrationConfig.LoginPromptEnabled&&integrationConfig.HasTasks&&currentToolUrl!=null&&(integrationConfig.LoginPromptType==UtraIntegrationType.Prompt?messageChannel.postMessage({type:"portal:modal",modalId:currentPopupHID,contents:getModalContents(currentPopupHID,"300","large",integrationConfig.LoginFOHeaderText,integrationConfig.LoginButtonText)}):setTimeout(()=>{messageChannel.postMessage({type:"portal:panel",correlationId:"panel-1",panelType:"small",panelTitle:integrationConfig.LoginFOHeaderText,attributes:{onClose:{callbackId:"panel-1-close"}}})},500))):currentToolUrl=""}};n.send()}function onEventFromIframe(n){if(n.key==="event"){const t=JSON.parse(n.newValue);switch(t.type){case"demo:closePanel":messageChannel.postMessage({type:"portal:panel:close",id:panelId})}}}var LoggedMessageChannel=function(){function n(n){var t=this;this.onmessage=function(){};this.onMessage=function(n){t.onmessage(n)};this.postMessage=function(n){t.messageChannel.postMessage(n)};this.messageChannel=n;this.messageChannel.onmessage=this.onMessage}return n}();const UtraIntegrationType={Prompt:1,Panel:2},integrationHost=`${window.location.protocol}//${window.location.hostname}`,enableLog=!1;var integrationConfig=null,messageChannel,panelId,portalId,modalId,currentPopupHID="BCUltraBlock",currentCourseId="",currentUserId="",currentToolUrl="",showPopupInCourse=!1,showPanelInCourse=!0;window.addEventListener("message",onPostMessageReceived,!1);window.parent.postMessage({type:"integration:hello"},`${window.__lmsHost}/*`);window.addEventListener("storage",onEventFromIframe);currentUserId=window.__userid;